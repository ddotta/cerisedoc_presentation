---
title: "PrÃ©sentation cerisedoc"
subtitle: "Outil documentaire sous Cerise"
author: "SSP/DEMESIS"
date: today

format:
  revealjs:
    transition: slide
    chalkboard: false
    slide-number: true
    fig-cap-location: bottom
    date-format: "DD/MM/YYYY"

execute:
  echo: false
  warning: false
  cache: false

editor:
  render-on-save: true
  markdown:
    wrap: 72
---

## Origine du projet

**Besoin exprimÃ© lors du diagnostic des pÃ´les Ã‰tudes et Diffusion**

<br>

Documentation hÃ©tÃ©rogÃ¨ne ou insuffisante des sources de donnÃ©es  

- Faciliter lâ€™**appropriation** des sources  
- AmÃ©liorer la **traÃ§abilitÃ©** des donnÃ©es  
- Obtenir un **aperÃ§u** des donnÃ©es avant habilitation  

## Installation depuis GitLab

```{.r}
# Installation du package
install.packages("remotes")

remotes::install_git(
  "https://gitlab.forge.agriculture.rie.gouv.fr/ssp/bmis/packages/cerisedoc",
  dependencies = TRUE,
  git = "external"
)
```

<br>

ğŸ’¡ **Si package adoptÃ©** : installation systÃ©matique sur Cerise pour Ã©viter
les installations individuelles

## Lancement de l'application

::: {.columns}

::: {.column width="50%"}
### Via code R

```{.r}
library(cerisedoc)
affiche_documentation()
```
:::

::: {.column width="50%"}
### Via addin RStudio

- Menu **Addins** dans RStudio  
- Cliquer sur **"Afficher documentation"**  
- L'application s'ouvre dans le navigateur  

![](img/addin.png)
:::

:::

## Formats supportÃ©s {.smaller}

::: {.columns}

::: {.column width="33%"}
### CSV
- DÃ©tection automatique de lâ€™encodage  
- Choix du dÃ©limiteur (`;`, `,`, `|`)  
- Pour les fichiers volumineux, seules les **10 000 premiÃ¨res lignes** sont lues  
:::

::: {.column width="33%"}
### RDS
- Format R natif  
- Pas de possibilitÃ© de lire une partie des lignes  
- Les fichiers de plus de **100 Mo sont ignorÃ©s**  
:::

::: {.column width="33%"}
### PARQUET
- Format Apache Arrow  
- Pour les fichiers volumineux, seules les **10 000 premiÃ¨res lignes** sont lues  
:::

:::

## Ce qui est documentÃ© {.smaller}

Pour chaque fichier, la documentation contient :

::: {.columns}

::: {.column width="50%"}
**Structure**

- ğŸ“Š Nombre de lignes et de colonnes  
- ğŸ·ï¸ Noms des variables  
- ğŸ”¤ Types de donnÃ©es  
- ğŸ’¾ Taille du fichier  
:::

::: {.column width="50%"}
**Contenu**

- ğŸ“ˆ Statistiques descriptives  
- ğŸ”¢ Valeurs manquantes  
- ğŸ¯ Valeurs uniques  
- ğŸ“… Date de derniÃ¨re modification  
:::

:::

<br>

ğŸ’¡ Documentation au format **HTML** consultable indÃ©pendamment via
lâ€™explorateur de fichiers Cerise

## Historique des versions

Un historique de la documentation est gÃ©rÃ© par **cerisedoc**.  
Les fichiers HTML sont stockÃ©s dans les rÃ©pertoires `archive_doc` sous :

```
/var/data/nfs/CERISE/01-Espace-de-Partage/SSP/BMIS/cerisedocumentation/
```

![](img/historique_versions.png)

## README

S'il existe, cerisedoc affiche le contenu d'un fichier **README** ou
**LISEZMOI** (formats `md` ou `txt`).

![](img/readme.png)

## Processus automatisÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ordonnancement quotidien (ordobatchr)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VÃ©rification des modifications         â”‚
â”‚  (via attribut de date)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
          â”‚ ModifiÃ©?â”‚
          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          Non  â”‚  Oui
```
```
          â”‚    â”‚
          â”‚    â–¼
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  â”‚ GÃ©nÃ©ration HTML      â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â”‚            â–¼
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  â”‚ Envoi notifications â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â­ï¸ Fichier suivant
```

## Onglet "Navigation Fichiers"

### FonctionnalitÃ©s

::: {.columns}

::: {.column width="50%"}
- Parcours de lâ€™arborescence  
- SÃ©lection de fichier HTML  
- Affichage intÃ©grÃ© dans lâ€™application  
- DÃ©tection automatique du projet  
:::

::: {.column width="50%"}
![](img/navigation.png)
:::

:::

## Onglet "Chemins Ã  traiter"

![](img/chemin_a_traiter.png)

## Actions disponibles {.smaller}

::: {.columns}

::: {.column width="50%"}
### â• Ajouter un chemin

1. Cliquer sur "Choisir un rÃ©pertoire"
2. Naviguer dans l'arborescence
3. (Optionnel) Indiquer le dÃ©limiteur CSV
4. Cliquer sur "Ajouter"
5. Enregistrement immÃ©diat
:::

::: {.column width="50%"}
### ğŸ—‘ï¸ Supprimer un chemin

- SÃ©lectionner une ligne du tableau
- Cliquer sur "Supprimer"
- Confirmation de suppression

### ğŸ”„ GÃ©nÃ©rer

- Bouton sur chaque ligne
- Lance la gÃ©nÃ©ration immÃ©diate (pour ne pas attendre le lendemain par ex.)
:::

:::

<br>

âš ï¸ **Important** : Les chemins doivent Ãªtre uniques

## Onglet "Recherche Cerise"

Recherche dans l'ensemble de l'arborescence Cerise

**PÃ©rimÃ¨tres couverts** :

- `02-Espace-de-Production`
- `03-Espace-de-Diffusion`
- `01-Espace-de-Partage/SSP`
- `01-Espace-de-Partage/SRISE`

---

## Options de recherche {.smaller}

::: {.columns}

::: {.column width="50%"}
### ğŸ”¤ Sensible Ã  la casse

"Fichier.csv" â‰  "fichier.csv"

### ğŸ“ Expression rÃ©guliÃ¨re

Quelques exemples :

- `^test` => Fichiers commenÃ§ant par "test"  
- `^test.*\\.csv$` => Fichiers commenÃ§ant par "test" et finissant par ".csv"  
- `^.*\.parquet$` => Tous les fichiers parquet  

### ğŸ“ RÃ©pertoire spÃ©cifique

Limite la recherche Ã  un sous-rÃ©pertoire pour cibler les rÃ©sultats.
:::

::: {.column width="50%"}
![](img/fenetre_recherche.png)
:::

:::

## RÃ©sultats de recherche

Pour chaque fichier trouvÃ© :

![](img/resultats_recherche.png)

âš ï¸ Attention, pas de recherche possible en temps rÃ©el => si vous avez crÃ©Ã© un fichier dans la journÃ©e et que vous le recherchez avec cerisedoc, il ne sera pas trouvÃ© (car non indexÃ© dans la BDD).

## Abonnements

Recevez **UN SEUL email** regroupant **toutes** les modifications de vos rÃ©pertoires suivis

<br>

**FonctionnalitÃ©s**

- Inscription/dÃ©sinscription
- Emails groupÃ©s par utilisateur
- DÃ©tection des suppressions

## Contenu d'un email groupÃ© {.smaller}

**Structure du message** :

- ğŸ“Š **RÃ©sumÃ© global** : nombre total de modifications
- ğŸ“ **DÃ©tails par rÃ©pertoire** avec sections :
  - â• Nouveaux fichiers (ajouts)
  - ğŸ”„ Fichiers modifiÃ©s
  - ğŸ—‘ï¸ Fichiers supprimÃ©

## DÃ©tection des suppressions

### Principe

CeriseDoc **suit** tous les fichiers documentÃ©s et **dÃ©tecte** les suppressions

::: {.columns}

::: {.column width="50%"}
**MÃ©canisme**

- Table `fichiers_suivis` en BDD
- Enregistrement Ã  chaque traitement
- Comparaison avec l'existant
- Marquage des fichiers supprimÃ©s
:::

::: {.column width="50%"}
**Dans l'email**

- Section dÃ©diÃ©e "Fichiers supprimÃ©s"
- Liste des fichiers concernÃ©s
- Par rÃ©pertoire
- Avec date de dÃ©tection
:::

:::

## ğŸ“§ Exemple d'email groupÃ© {.smaller}

```
Objet : [CeriseDoc] Nouvelles documentations gÃ©nÃ©rÃ©es pour le(s) rÃ©pertoire(s) suivant(s) :

Bonjour,

Les documentations suivantes ont Ã©tÃ© gÃ©nÃ©rÃ©es :

- /root_cerise/01-Espace-de-Partage/SSP/BMIS/cerisedoc/inst/extdata
- /root_cerise/01-Espace-de-Partage/SSP/BMIS/TestExport/test_cerisedoc

Vous recevez cet email car vous Ãªtes abonnÃ© Ã  ces chemins ou Ã  leurs sous-rÃ©pertoires.

Pour gÃ©rer vos abonnements, utilisez l'onglet 'Abonnement' dans l'application CeriseDoc.

Cordialement,
L'Ã©quipe CeriseDoc
```


## Organisation des fichiers HTML

```
cerisedocumentation/
â”œâ”€â”€ CERISE/
â”‚   â”œâ”€â”€ 02-Espace-de-Production/
â”‚   â”‚   â””â”€â”€ SSP/
â”‚   â”‚       â””â”€â”€ fichier1.html
â”‚   â”œâ”€â”€ 03-Espace-de-Diffusion/
â”‚   â”‚   â””â”€â”€ documentation.html
â”‚   â””â”€â”€ 01-Espace-de-Partage/
â”‚       â”œâ”€â”€ SSP/
â”‚       â””â”€â”€ SRISE/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ chemins_a_traiter.csv
â”‚   â””â”€â”€ abonnements.db
â””â”€â”€ lancement.R
```

## Quelques cas d'usage possibles

- **En cas de script R non fonctionnel** : si un script R ne fonctionne plus, un 1er rÃ©flexe peut Ãªtre de vÃ©rifier que le format des donnÃ©es en entrÃ©e n'ont pas Ã©tÃ© modifiÃ©s par les responsables de source (s'il est abonnÃ© Ã  la source, l'agent aura reÃ§u un mail).
- **Avant une demande d'habilitation Ã  une source** : un agent peut consulter le dictionnaire des variables d'un jeu de donnÃ©es pour s'assurer qu'il contient bien l'information dont l'agent a besoin.
